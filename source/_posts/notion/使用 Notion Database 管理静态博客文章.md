---
categories:
  - 博客折腾手册
date: 2021/12/20
excerpt: 当博客文章变多了之后就发现，放在 hexo 的本地文件夹中管理就有些力不从心了
show_category: Yes
status: 待发布
tags:
  - blog
  - hexo
  - notion
urlname: notion-markdown-blog
title: 使用 Notion Database 管理静态博客文章
---


<aside>

<img class="emoji" draggable="false" alt="👌" src="https://twemoji.maxcdn.com/v/13.1.0/72x72/1f44c.png"/> 我终于想起来 Github 的账号了, 有段时间没有更新博客了，换了新工作总归是有一点适应期，后面应该就会照常更新了
</aside>

## 背景

其实在最开始计划的时候，第一篇文章应该是另外一个主题，但是每次开始写文章的时候都忍不住去折腾一下博客（又可以水两篇文章了）

### hexo 文章管理

在准备写文章的时候发现 hexo 在文章多了之后管理上很不方便，现在博客也已经有了 150+ 博文了，所有的文章都放在了 `_posts` 文件夹下面

![博客源文件目录](/notion_images/8e47df0c83c5593a2d795e6d409f78e4.png)

博客源文件目录

如上图所示，虽然文章按照分类拆分了文件夹进行管理，但是还是不是特别清晰，毕竟不是所有的文章都是专题文章，还是有一部分笔记或者是其他文章的，在 hexo 中我们给文章分配了标签分类等字段用来区分，但是在实际的文件管理上还是不行

### 语雀文章管理

之前还在用语雀记录笔记的时候，文章是直接放在了 [语雀](https://www.yuque.com/mohuishou/blog) 上然后通过 [yuque-hexo](https://github.com/x-cold/yuque-hexo) + github actions 自动发布，但是后面将笔记切回 notion 之后，就没用语雀同步了。

<aside>

<img src="data:image/svg+xml;utf8,%3Csvg%20class%3D%22icon%22%20style%3D%22width%3A%201em%3Bheight%3A%201em%3Bvertical-align%3A%20middle%3Bfill%3A%20currentColor%3Boverflow%3A%20hidden%3B%22%20viewBox%3D%220%200%201024%201024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M512%20909.061224c-218.906122%200-397.061224-178.155102-397.061224-397.061224s178.155102-397.061224%20397.061224-397.061224%20397.061224%20178.155102%20397.061224%20397.061224-178.155102%20397.061224-397.061224%20397.061224z%22%20fill%3D%22%23F2CB51%22%20%2F%3E%3Cpath%20d%3D%22M520.881633%20587.232653c-11.493878%200-19.853061-9.404082-19.853062-20.37551%200.522449-17.763265%201.567347-30.302041%204.179592-39.183674%202.612245-9.404082%206.791837-17.763265%2012.016327-25.6%204.179592-5.22449%209.926531-9.404082%2017.763265-15.673469%205.22449-3.657143%2011.493878-8.359184%2016.718367-13.061224%2021.942857-19.330612%2030.82449-31.346939%2035.004082-38.661225%205.22449-8.881633%207.314286-18.808163%207.314286-29.779592%200-18.808163-7.314286-34.481633-21.942857-48.065306-15.15102-14.106122-35.526531-20.897959-62.693878-20.897959-26.122449%200-39.183673%206.791837-52.767347%2019.330612-14.628571%2013.061224-22.987755%2031.346939-26.122449%2056.946939-1.567347%2010.971429-10.971429%2018.808163-21.942857%2017.240816-10.971429-1.567347-18.808163-10.971429-17.240816-21.942857%204.179592-35.004082%2017.763265-62.693878%2039.706122-82.02449%2023.510204-20.897959%2046.497959-29.257143%2079.412245-29.257143%2036.571429%200%2066.873469%2010.44898%2089.338776%2031.346939%2022.987755%2020.897959%2035.004082%2047.020408%2035.004081%2077.322449%200%2017.763265-4.179592%2033.959184-12.538775%2049.110204-7.836735%2014.106122-21.942857%2030.302041-43.363266%2049.110204-6.791837%206.269388-14.106122%2010.971429-19.853061%2015.151021-3.134694%202.612245-7.836735%205.746939-9.404081%207.314285-2.612245%203.657143-4.179592%207.314286-5.22449%2012.016327-1.044898%203.134694-2.089796%2010.971429-2.612245%2029.779592-1.044898%2010.971429-9.926531%2019.853061-20.897959%2019.853061z%22%20fill%3D%22%23AF8015%22%20%2F%3E%3Cpath%20d%3D%22M520.359184%20677.093878m-29.779592%200a29.779592%2029.779592%200%201%200%2059.559184%200%2029.779592%2029.779592%200%201%200-59.559184%200Z%22%20fill%3D%22%23AF8015%22%20%2F%3E%3C%2Fsvg%3E" alt="data:image/svg+xml;utf8,%3Csvg%20class%3D%22icon%22%20style%3D%22width%3A%201em%3Bheight%3A%201em%3Bvertical-align%3A%20middle%3Bfill%3A%20currentColor%3Boverflow%3A%20hidden%3B%22%20viewBox%3D%220%200%201024%201024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M512%20909.061224c-218.906122%200-397.061224-178.155102-397.061224-397.061224s178.155102-397.061224%20397.061224-397.061224%20397.061224%20178.155102%20397.061224%20397.061224-178.155102%20397.061224-397.061224%20397.061224z%22%20fill%3D%22%23F2CB51%22%20%2F%3E%3Cpath%20d%3D%22M520.881633%20587.232653c-11.493878%200-19.853061-9.404082-19.853062-20.37551%200.522449-17.763265%201.567347-30.302041%204.179592-39.183674%202.612245-9.404082%206.791837-17.763265%2012.016327-25.6%204.179592-5.22449%209.926531-9.404082%2017.763265-15.673469%205.22449-3.657143%2011.493878-8.359184%2016.718367-13.061224%2021.942857-19.330612%2030.82449-31.346939%2035.004082-38.661225%205.22449-8.881633%207.314286-18.808163%207.314286-29.779592%200-18.808163-7.314286-34.481633-21.942857-48.065306-15.15102-14.106122-35.526531-20.897959-62.693878-20.897959-26.122449%200-39.183673%206.791837-52.767347%2019.330612-14.628571%2013.061224-22.987755%2031.346939-26.122449%2056.946939-1.567347%2010.971429-10.971429%2018.808163-21.942857%2017.240816-10.971429-1.567347-18.808163-10.971429-17.240816-21.942857%204.179592-35.004082%2017.763265-62.693878%2039.706122-82.02449%2023.510204-20.897959%2046.497959-29.257143%2079.412245-29.257143%2036.571429%200%2066.873469%2010.44898%2089.338776%2031.346939%2022.987755%2020.897959%2035.004082%2047.020408%2035.004081%2077.322449%200%2017.763265-4.179592%2033.959184-12.538775%2049.110204-7.836735%2014.106122-21.942857%2030.302041-43.363266%2049.110204-6.791837%206.269388-14.106122%2010.971429-19.853061%2015.151021-3.134694%202.612245-7.836735%205.746939-9.404081%207.314285-2.612245%203.657143-4.179592%207.314286-5.22449%2012.016327-1.044898%203.134694-2.089796%2010.971429-2.612245%2029.779592-1.044898%2010.971429-9.926531%2019.853061-20.897959%2019.853061z%22%20fill%3D%22%23AF8015%22%20%2F%3E%3Cpath%20d%3D%22M520.359184%20677.093878m-29.779592%200a29.779592%2029.779592%200%201%200%2059.559184%200%2029.779592%2029.779592%200%201%200-59.559184%200Z%22%20fill%3D%22%23AF8015%22%20%2F%3E%3C%2Fsvg%3E" width="40px" /> 语雀本身功能很丰富更新也比较及时，但是很多功能只是做了，做的不够好不够精细，细致上体验下去的时候用着就会有点难受。并且没有像 notion 的 database 的功能，在一些场景下不够灵活。当然语雀本身还是比较好用的，用来记录一些专辑会比较舒适流畅，但是不是特别适合用来记录笔记，特别是标签功能，做的有点残废，不知道现在有没有好一些。
</aside>

![](/notion_images/124bab5a282305e9dde37950598c9f1e.png)

可以看到上图，语雀的文章本身是没有其它额外的属性的，所以我们为了支持 hexo 的 yaml frontmatter 就做了一些额外的约定和处理，但是在 notion 的 database 里面这个问题就不存在了，刚刚好可以完美的解决这个问题

![](/notion_images/85166a2fe5912454dcab79ca642ef2bf.png)

## 方案

ok, idea 有了之后，我们大概想想方案，我大概调研了一下现在存在的主要方案大概可以分为三种

- 第一种就是，使用 notion database 作为 baas 后端，另写前端页面来获取数据渲染，这种方案的典型代表是 [nextjs-notion-starter-kit](https://github.com/transitive-bullshit/nextjs-notion-starter-kit)
    
    这种方式的主要问题是，在国内的加载速度和不确定性的问题，因为国情原因，notion 访问本身比较慢，并且还存在一些不确定性
    
- 第二种和第一种类似，但是第二种方案可以直接生成静态页面，所以就有着和静态博客一样的速度和灵活性，我们可以直接部署在国内。这种方法的典型方式是 [Gatsby+Notion](https://www.gatsbyjs.com/plugins/gatsby-source-notion-api/)
    
    这种方式的主要问题是主题不够丰富，大概率需要自己修改很多东西才能用，和成熟的 hugo、hexo 比，差的有点太多
    
- 第三种方案就是将 Notion Page 转换为 Markdown 文件，然后就可以直接使用 hugo、hexo 等成熟的静态博客生成器了
这个的主要问题是虽然现在 notion 官方开放了 api，但是没有 api 可以直接将 notion 的数据结构之间转换为 markdown，现在虽然有一些第三方库（例如 [notion2md](https://github.com/echo724/notion2md) ）支持，但是存在着各种各样的问题，要么不支持图片，要么不支持 table 等格式，总是会欠缺一些

经过对比，和当前遇到的问题，我选择了第三种方案，然后自己造个简单的转换轮子

- 我现在的 hexo 主题使用的还算满意，已经折腾改造过很多次了，不想再改造了（预告一下后面有一篇文章给大家介绍如何使用这个主题给自己的博客也加上左侧的章节目录）
- 其次是 notion 其实自己可以导出 markdown 文件，我只要使用 notion cookie 调用一下就可以了，工作量其实不是很大，并且后续 notion 即使出其他的 block 大概率也会支持导出，这样我们就不用去单独做兼容了

**ok，思路有了，我们看一下最后的方案**

![Group 1 (2).png](/notion_images/bcffa6ac7af1f11f2099538f04bc674c.png)

- 使用 Notion Database 作为我们的存储后端
- Notion Database 中的属性对应到 Markdown 中 YAML FrontMatter
- 为了避免每次都获取所有的文章数据，我们添加一个 `status` 字段，当 `status` 为 `待发布` 的时候我们才去下载对应的文章，文章下载完成之后，我们就把这篇文章的状态修改为 `已发布`
- 由于 notion 的导出 api 导出的文件是一个文件夹，所以我们导出之后需要解压缩
- 导出的 markdown 文件中，属性的字段会被放在文章的标题下，所以我们需要做一些转换，把它转为 YAML FrontMatter
- 最后 notion 在导出文件的时候如果里面包含了图片，会创建一个文件夹，我们需要把文件夹中的图片移动到我们需要的目录，例如统一放到 `img` 目录下

## 使用

具体代码就不贴了，也没有几行，看下最后的成果就行了（这篇文章就是）

```protobuf

```